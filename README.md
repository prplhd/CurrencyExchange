# CurrencyExchange

REST API для описания валют, обменных курсов и расчёта конвертации.  
Проект выполнен по ТЗ «Обмен валют» из  
[Java Роадмапа Сергея Жукова](https://zhukovsd.github.io/java-backend-learning-course/projects/currency-exchange/).

---

## Краткое описание

Сервис предоставляет HTTP-интерфейс для:

- хранения списка валют (код, название, символ);
- хранения обменных курсов между валютами;
- расчёта конвертации произвольной суммы из одной валюты в другую по заданным правилам.

Данные хранятся в локальной базе SQLite.  
В репозитории уже лежит подготовленный файл базы данных `currency_exchange.db`.

Кроме REST API, в проекте есть простой тестовый фронтенд (HTML + JavaScript) для ручного тестирования эндпоинтов из браузера.

---

## Основные возможности

- Просмотр всех валют и деталей по каждой валюте.
- Добавление новых валют.
- Просмотр всех обменных курсов и конкретного курса по валютной паре.
- Добавление новых обменных курсов.
- Обновление существующего курса (метод `PATCH`).
- Расчёт конвертации:
    - по прямому курсу (A→B);
    - по обратному курсу (если есть только B→A);
    - через USD как промежуточную валюту (если есть A→USD и B→USD).
- Единый формат ответа при ошибках:  
  `{"message": "…описание ошибки…"}`.

---

## Технологии

- **Язык:** Java 21+
- **Сборка:** Maven
- **Сервлеты:** Jakarta Servlet API
- **Сервер приложений:** Apache Tomcat 11+
- **База данных:** SQLite
- **Доступ к БД:** JDBC
- **JSON:** Gson
- **Фронтенд для тестирования:** статический HTML + jQuery

---

## Требования

Для сборки и запуска проекта нужны:

- JDK 21 или новее
- Maven 3.9+
- Apache Tomcat 11+ (или другой контейнер сервлетов с поддержкой Jakarta Servlet 6)
- SQLite JDBC-драйвер (подтягивается как Maven-зависимость)
- Gson для работы с JSON (подтягивается как Maven-зависимость)
---

## Подключение базы данных

В корне репозитория лежит файл базы данных:

- `currency_exchange.db` — SQLite БД с таблицами `Currencies` и `ExchangeRates` и начальными данными.

Приложение читает настройки подключения к БД из файла `db.properties`, находящегося в classpath  
`src/main/resources/db.properties`.

Пример содержимого:

```properties
db.url=jdbc:sqlite:/absolute/path/to/currency_exchange.db
db.driver=org.sqlite.JDBC
```

### Рекомендации по настройке

1. Убедитесь, что файл `currency_exchange.db` находится в понятном месте  
   (можно оставить в корне проекта или перенести в отдельную папку).

2. В `db.url` пропишите корректный абсолютный путь к файлу базы, например:

   ```text
   jdbc:sqlite:/home/user/CurrencyExchange/currency_exchange.db
   jdbc:sqlite:C:/dev/CurrencyExchange/currency_exchange.db
   ```

3. Убедитесь, что пользователь, от имени которого запущен Tomcat, имеет права на чтение/запись этого файла.

---

## Сборка и запуск

### 1. Клонирование репозитория

```bash
git clone https://github.com/prplhd/CurrencyExchange.git
cd CurrencyExchange
```

### 2. Настройка `db.properties`

Укажите в файле `src/main/resources/db.properties` настройки подключения к `currency_exchange.db` (см. пример выше).

### 3. Сборка проекта

```bash
mvn clean package
```

После сборки в каталоге `target/` будет создан WAR-файл (например, `CurrencyExchange.war`).

### 4. Деплой в Tomcat

Есть два основных варианта.

#### Вариант 1: через IntelliJ IDEA

- Настроить локальный Tomcat.
- Добавить артефакт `war exploded`.
- Задать нужный `context path` (часто `/` по умолчанию).

#### Вариант 2: вручную

1. Скопировать `target/CurrencyExchange.war` в каталог `webapps` Tomcat.
2. Запустить (или перезапустить) Tomcat.
3. Приложение станет доступно по адресу, например:
    - `http://localhost:8080/CurrencyExchange` — если `context path` равен имени WAR;
    - `http://localhost:8080/` — если приложение развёрнуто как корневое (ROOT).

Во всех примерах ниже предполагается базовый URL:

```text
http://localhost:8080
```

Если у приложения есть `context path` (`/CurrencyExchange`), добавьте его после порта.

---

## Структура проекта

Упрощённая структура:

```text
CurrencyExchange/
├── pom.xml
├── currency_exchange.db                 # Файл базы данных SQLite
└── src/
    └── main/
        ├── java/
        │   └── ru/prplhd/currencyexchange/
        │       ├── controller/          # Сервлеты
        │       ├── service/             # Бизнес-логика
        │       ├── dao/                 # Доступ к БД (JDBC)
        │       ├── dto/                 # DTO для запросов и ответов
        │       ├── mapper/              # Мапперы моделей в DTO и обратно
        │       ├── exception/           # Кастомные исключения
        │       ├── util/                # Вспомогательные классы (JsonResponseWriter и т.п.)
        │       └── db/                  # Подключение к БД (ConnectionProvider)
        ├── resources/
        │   └── db.properties            # Настройки подключения к SQLite
        └── webapp/
            ├── index.html               # Тестовый фронтенд
            └── js/
                └── app.js               # AJAX-запросы к REST API
```

(Фактическая структура может немного отличаться, см. репозиторий.)

---

## REST API — краткий обзор

| Метод | Путь                                          | Описание                                 |
|-------|-----------------------------------------------|------------------------------------------|
| GET   | `/currencies`                                 | Список всех валют                        |
| GET   | `/currency/{CODE}`                            | Информация о конкретной валюте           |
| POST  | `/currencies`                                 | Создание новой валюты                    |
| GET   | `/exchangeRates`                              | Список всех обменных курсов              |
| GET   | `/exchangeRate/{BASE}{TARGET}`                | Обменный курс по валютной паре           |
| POST  | `/exchangeRates`                              | Создание нового обменного курса          |
| PATCH | `/exchangeRate/{BASE}{TARGET}`                | Обновление существующего обменного курса |
| GET   | `/exchange?from=BASE&to=TARGET&amount=AMOUNT` | Расчёт обмена указанной суммы            |

Далее — более подробное описание основных эндпоинтов.

---

## REST API — подробности

### 1. Валюты

#### `GET /currencies`

Получение списка всех валют.

**Пример ответа:**

```json
[
  {
    "id": 1,
    "name": "United States dollar",
    "code": "USD",
    "sign": "$"
  },
  {
    "id": 2,
    "name": "Euro",
    "code": "EUR",
    "sign": "€"
  }
]
```

**Коды ответа:**

- `200` — успех
- `500` — внутренняя ошибка сервера (например, проблема с БД)

---

#### `GET /currency/{CODE}`

Получение информации о конкретной валюте по её коду (`USD`, `EUR` и т.п.).

**Пример ответа:**

```json
{
  "id": 2,
  "name": "Euro",
  "code": "EUR",
  "sign": "€"
}
```

**Коды ответа:**

- `200` — успех
- `400` — код валюты не передан или имеет некорректный формат
- `404` — валюта не найдена
- `500` — внутренняя ошибка сервера

---

#### `POST /currencies`

Создание новой валюты.

Тело запроса — форма `application/x-www-form-urlencoded`:

- `name` — полное название валюты
- `code` — трёхбуквенный код (например, `USD`)
- `sign` — символ или короткое обозначение валюты (опционально)


**Пример ответа:**

```json
{
  "id": 5,
  "name": "Swiss franc",
  "code": "CHF",
  "sign": "Fr"
}
```

**Коды ответа:**

- `201` — валюта создана
- `400` — не хватает обязательного поля или нарушены правила валидации
- `409` — валюта с таким кодом уже существует
- `500` — внутренняя ошибка сервера

---

### 2. Обменные курсы

#### `GET /exchangeRates`

Получение списка всех обменных курсов.

**Пример ответа:**

```json
[
  {
    "id": 1,
    "baseCurrency": {
      "id": 1,
      "name": "United States dollar",
      "code": "USD",
      "sign": "$"
    },
    "targetCurrency": {
      "id": 2,
      "name": "Euro",
      "code": "EUR",
      "sign": "€"
    },
    "rate": 0.99
  }
]
```

**Коды ответа:**

- `200` — успех
- `500` — внутренняя ошибка сервера

---

#### `GET /exchangeRate/{BASE}{TARGET}`

Получение конкретного обменного курса.  
Валютная пара задаётся слитно: `USDRUB`, `EURUSD`, `AUDEUR` и т.п.

**Пример ответа:**

```json
{
  "id": 0,
  "baseCurrency": {
    "id": 0,
    "name": "United States dollar",
    "code": "USD",
    "sign": "$"
  },
  "targetCurrency": {
    "id": 2,
    "name": "Russian Ruble",
    "code": "RUB",
    "sign": "₽"
  },
  "rate": 80
}
```

**Коды ответа:**

- `200` — успех
- `400` — некорректный путь (пара не передана или имеет неверный формат)
- `404` — курс для такой пары не найден
- `500` — внутренняя ошибка сервера

---

#### `POST /exchangeRates`

Создание нового обменного курса.

Тело запроса — `application/x-www-form-urlencoded`:

- `baseCurrencyCode` — код базовой валюты (`USD`)
- `targetCurrencyCode` — код целевой валюты (`EUR`)
- `rate` — курс (десятичное число)

**Пример ответа:**

```json
{
  "id": 0,
  "baseCurrency": {
    "id": 0,
    "name": "United States dollar",
    "code": "USD",
    "sign": "$"
  },
  "targetCurrency": {
    "id": 1,
    "name": "Euro",
    "code": "EUR",
    "sign": "€"
  },
  "rate": 0.99
}
```

**Коды ответа:**

- `201` — курс создан
- `400` — отсутствует нужное поле или не проходит валидацию
- `404` — одна или обе валюты не существуют в БД
- `409` — курс для такой валютной пары уже существует
- `500` — внутренняя ошибка сервера

---

#### `PATCH /exchangeRate/{BASE}{TARGET}`

Обновление существующего обменного курса.

Тело запроса — `application/x-www-form-urlencoded`:

- `rate` — новый курс

```json
{
  "id": 0,
  "baseCurrency": {
    "id": 0,
    "name": "United States dollar",
    "code": "USD",
    "sign": "$"
  },
  "targetCurrency": {
    "id": 2,
    "name": "Russian Ruble",
    "code": "RUB",
    "sign": "₽"
  },
  "rate": 80
}
```

**Коды ответа:**

- `200` — курс обновлён
- `400` — отсутствует поле `rate` или нарушены правила валидации
- `404` — курс для такой пары не найден
- `500` — внутренняя ошибка сервера

---

### 3. Обмен валюты

#### `GET /exchange?from=BASE&to=TARGET&amount=AMOUNT`

Расчёт обмена суммы из одной валюты в другую.

**Параметры:**

- `from` — код исходной валюты (например, `USD`)
- `to` — код целевой валюты (например, `AUD`)
- `amount` — сумма для конвертации

Пример:  
`GET /exchange?from=USD&to=AUD&amount=10`

**Пример ответа:**

```json
{
  "baseCurrency": {
    "id": 1,
    "name": "United States dollar",
    "code": "USD",
    "sign": "$"
  },
  "targetCurrency": {
    "id": 3,
    "name": "Australian dollar",
    "code": "AUD",
    "sign": "A$"
  },
  "rate": 1.45,
  "amount": 10.00,
  "convertedAmount": 14.50
}
```

**Коды ответа (в зависимости от сценария):**

- `200` — успех, обмен посчитан
- `400` — некорректные параметры (`from`, `to`, `amount`)
- `404` — не хватает нужных курсов для расчёта
- `500` — внутренняя ошибка сервера

---

### 4. Ответ при ошибке

Во всех эндпоинтах, при возникновении любой ошибки, сервис возвращает JSON вида:

```json
{
  "message": "Описание ошибки"
}
```

Значение `message` зависит от типа ошибки, HTTP-код соответствует ситуации (`400`, `404`, `409`, `500` и т.д.).

---

## Тестовый фронтенд

Простой фронтенд для тестирования API находится в `src/main/webapp`:

- `index.html` — страница с таблицами и формами.
- `js/app.js` — скрипт, который отправляет AJAX-запросы к REST API.

Базовый URL бэкенда определяется автоматически в `app.js` на основе адреса, с которого открыт фронтенд:

```javascript
const host = window.location.origin;
```

---

## Спасибо за внимание к моему проекту!

---